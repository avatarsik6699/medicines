NestJS + TypeORM + PostgreSQL + Testcontainers

Общая концепция
Основная идея заключается в том, чтобы использовать реальную базу данных (PostgreSQL) для интеграционных тестов, но изолировать её от основной среды разработки. Для этого используется Testcontainers — инструмент, который запускает контейнеры Docker с необходимыми сервисами (в данном случае PostgreSQL). Это позволяет:

Запускать тесты в изолированной среде.
Гарантировать, что тестовая база данных чистая перед каждым тестом.
Использовать реальную базу данных, а не моки, что делает тесты более надежными.

npm install --save-dev @nestjs/testing @testcontainers/postgresql typeorm pg

Преимущества такого подхода
Изолированность : Каждый тест выполняется в своей собственной базе данных.
Реальная среда : Тесты используют реальную базу данных, что делает их более надежными.
Автоматизация : Testcontainers управляет жизненным циклом контейнера, что упрощает настройку.

Потенциальные проблемы и решения
Скорость тестов :
Запуск контейнера может замедлить тесты. Решение: используйте один контейнер для всех тестов (например, на уровне beforeAll).
Очистка базы данных :
Если база данных не очищается между тестами, могут возникнуть конфликты. Решение: используйте транзакции или очищайте таблицы перед каждым тестом.
Локальное отключение Docker :
Если Docker недоступен, тесты не смогут запуститься. Решение: добавьте проверку наличия Docker перед запуском тестов.